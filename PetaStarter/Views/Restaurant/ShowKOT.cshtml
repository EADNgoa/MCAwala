@model IEnumerable<KOTscreen>
@{
    Layout = null;
}

<!DOCTYPE html>

<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>KOT screen</title>
    <link rel="icon" href="~/Custom/BBS.ico">
    @Styles.Render("~/Content/themes/base/css")
    @Scripts.Render("~/bundles/modernizr")
    @Styles.Render("~/Content/css")
    @Scripts.Render("~/bundles/jquery")
</head>
<body>
   
        <h1>KOTs at @ViewBag.RestaurantName</h1>
        <hr />
        <button id="StartFetch" >Begin Monitoring</button>
        <div id="KOTList">
            @foreach (var item in Model)
            {
                @Html.Partial("KOT", item)
            }
        </div>
        

   
    @Scripts.Render("~/bundles/bootstrap")
    <!--Script references. -->
    <!--The jQuery library is required and is referenced by default in _Layout.cshtml. -->
    <!--Reference the SignalR library. -->
    <script src="~/Scripts/jquery.signalR-2.2.2.min.js"></script>
    <!--Reference the autogenerated SignalR hub script. -->
    <script src="~/signalr/hubs"></script>
    <!--SignalR script to update the chat page and send messages.-->
    <script>
            $(function () {
                // Reference the auto-generated proxy for the hub.
                var chat = $.connection.taskMasterHub;

                // Create a function that the hub can call back to display messages.
                chat.client.GetOurKOTs = function () {
                    location.href = location.href;
                };


                // Start the connection.
                $.connection.hub.logging = true;
                $.connection.hub.start().done(function () {
                    $('.SigRtoClients').click(function () {
                        // Call the Send method on the hub.
                        chat.server.groupSendKOT('@ViewBag.RestaurantName');
                    });

                    $('.ClickActive').click(function() {
                        $.post('@Url.Action("KOtitemReady")', { id: $(this).data('val')});
                        $(this).parent().css("background-color", "green");
                        $(this).hide();

                        //Check if all items are ready
                        if ($('.table-' + $(this).data('kot') + ' .ClickActive:checked').length == $('.table-' + $(this).data('kot') + ' .ClickActive').length) {
                            $('.table-' + $(this).data('kot')).delay(800).slideUp(8010);
                            chat.server.groupSendKOT('@ViewBag.RestaurantName');
                            location.href = location.href;
                        }

                    });

                    chat.server.joinRoom('@ViewBag.RestaurantName');

                });
            });



    </script>

</body>
</html>
